function typeaheadSource(query,process){$.ajax({url:"/api/search/typeahead/"+encodeURIComponent(query),dataType:"json",error:function(data){},success:function(data){handleTypeahead(data,function(err,proposals){return process(err?err:proposals)})}})}function handleTypeahead(data,callback){var proposals=[];for(var i in data){var proposal,parts=data[i].split(":");parts.length>1?(proposal=parts[1],map[proposal]=parts[0]):proposal=data[i],proposals.push(proposal)}return callback(null,proposals)}function navigateToRichSearch(searchQuery){var pack=window.location.hash.split("/")[1];window.location.href="/xref/#/"+pack+"/findUsages?query="+encodeURIComponent(searchQuery)}function submitSearchQuery(searchQuery,target){var $form=$("form[id^=search]");setSearchForm($form,searchQuery,target),$form.submit()}function setSearchForm($form,searchQuery,target){var lastSearchQuery=$("a.search-filter").attr("data-last-search"),sourceInput=$("<input>").attr("type","hidden").attr("name","source").val("typeahead");$form.append($(sourceInput));var searchTarget="all";lastSearchQuery==searchQuery&&"Search My CodeBox"==target&&(searchTarget="codebox");var targetInput=$("<input>").attr("type","hidden").attr("name","target").val(searchTarget);$form.append($(targetInput)),"codebox"==searchTarget?$("input.typeahead").val(lastSearchQuery):$("input.typeahead").val(searchQuery)}function buildQueryString(parameters){var qs="";for(var key in parameters){var value=parameters[key];qs+=encodeURIComponent(key)+"="+encodeURIComponent(value)+"&"}return qs.length>0&&(qs=qs.substring(0,qs.length-1)),qs}function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(window.location.search);return null==results?"":decodeURIComponent(results[1].replace(/\+/g," "))}function updateQueryStringParameter(uri,key,value){var re=new RegExp("([?|&])"+key+"=.*?(&|$)","i");return separator=-1!==uri.indexOf("?")?"&":"?",uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value}function handlePrettify(){addCodeRankPopover(),prettyPrint(),moveSourceToInitialPosition(),addSourceCodeHoverInteraction(),addSvgHoverInteraction(),addButtonHandlers(),formatLivecode()}function shareScenarioIfNeeded(){1==getParameterByName("shareScenario")&&openShareModal()}function setDeleteSnippetButton(){$(".btn-delete-snippet").click(function(){$btn=$(this);var ajaxUrl="",ajaxType="";"scenario"==$btn.attr("data-snippet-type")?(ajaxUrl="/api/scenarios/"+$btn.attr("id")+"/unstar?tag="+$btn.attr("data-tag"),ajaxType="PUT"):(ajaxUrl="/user-snippet/"+$btn.attr("data-snippet-id"),ajaxType="DELETE"),_gaq.push(["_trackEvent","codebox","delete-snippet"]),$.ajax({url:ajaxUrl,type:ajaxType,success:function(response){window.location.href=window.location.href},error:function(xhr,error){401==xhr.status?alert("The snippet you were trying to remove doesn't seem to belong to you. Please make sure you are logged-in with the correct user credentials."):alert("We were unable to remove the snippet, please try again later.\nIf the problem persist please contact us using the feedback option.")}})})}function addSaveSnippetPopover(){var sce_id=$(".save-snippet").attr("id");$(".save-snippet").tooltip({trigger:"hover focus",title:"Save Snippet to CodeBox",placement:"bottom"}),$(".save-snippet").popover({container:".green-popovers-container",html:!0,trigger:"manual",content:"Like this snippet? <a class='save-snippet save-snippet-popover' id='"+sce_id+"' href='#' data-action='star' data-label='save-snippet-link'>Save</a> it to your CodeBox!<br/><span class='save-snippet-subtext'>Codota will make sure it stands out when you need it again</span>",placement:"bottom"})}function showCodeBoxNavbarPopover(){-1!=window.location.href.indexOf("cbSnippetSaved")&&($(".codebox-navbar-item").popover({trigger:"manual",content:"The snippet was added to your CodeBox!",placement:"bottom"}).popover("show"),setTimeout(function(){$(".codebox-navbar-item").popover("hide")},6e3))}function showTagsOnSnippetHover(){$(".snippet-row").hover(function(){$(this).find(".snippet-details").addClass("btn-primary"),$(this).find(".snippet-details").removeClass("btn-default"),$(this).find(".btn-delete-snippet").show()},function(){$(this).find(".snippet-details").removeClass("btn-primary"),$(this).find(".snippet-details").addClass("btn-default"),$(this).find(".btn-delete-snippet").hide()})}function addCodeRankPopover(){var codeRankTimers={};$(".coderank-content").hover(function(){var codeRank=$(this);codeRankTimers[codeRank.attr("id")]=setTimeout(function(){setCodeRankPopover(codeRank)},500)},function(){var codeRank=$(this);clearTimeout(codeRankTimers[codeRank.attr("id")])})}function setCodeRankPopover(codeRank){codeRank.off("mouseenter mouseleave");var sceId=codeRank.attr("id");$.ajax({url:"/api/scenarios/"+sceId+"/coderank",success:function(response){var data=$(response).find(".coderank-popover-content").html();return codeRank.popover({delay:{show:"500",hide:"100"},trigger:"hover",content:function(){return _gaq.push(["_trackEvent","scenario","coderank-hover"]),data}}).popover("show"),data},error:function(xhr,error){console.log(error)}})}function loadGetInvolvedBtn(){$.get("/getInvolvedButton",function(rs){$("body").append(rs)})}function addSourceCodeHoverInteraction(){$(".source-hl[data-node]").each(function(i,hl){var svg=$(hl).parents(".item").find("svg"),svgContainer=$(svg).parents(".svg-container"),nodeId=$(hl).attr("data-node");svg.length>0&&svgContainer.length>0&&$(hl).hover(function(){$(".source-hl").removeClass("source-hl-selected"),$(svg).find(".node").find("path").attr("fill","white");var node=$(svg).find('g.node[data-nodeId="'+nodeId+'"]'),currentOffset={top:$(node).position().top-svgContainer.position().top,left:$(node).position().left-svgContainer.position().left},delta={top:currentOffset.top-150,left:currentOffset.left-50};svgContainer.animate({scrollTop:svgContainer.scrollTop()+delta.top,scrollLeft:svgContainer.scrollLeft()+delta.left}),node.find("path").attr("fill","LightSalmon "),$("#delNode").hide()},function(){$(svg).find('g.node[data-nodeId="'+nodeId+'"]').find("path").attr("fill","white")})})}function addButtonHandlers(){$(".source-link").click(function(){_gaq.push(["_trackEvent","scenario","navigate-to-origin"])}),$(".related-link").click(function(){var relatedSite=$(this).attr("data-site")||"internal";_gaq.push(["_trackEvent","scenario","click related",relatedSite])}),$(".show-full-source").click(function(){_gaq.push(["_trackEvent","scenario","show-full-source"]),window.location.href=updateQueryStringParameter(window.location.search,"fullSource","1")}),$("a.voteUp").click(function(e){e.preventDefault(),_gaq.push(["_trackEvent","scenario","vote-up"]),applyVote(this,1)}),$("a.voteDown").click(function(e){e.preventDefault(),_gaq.push(["_trackEvent","scenario","vote-down"]),applyVote(this,-1)}),$(".social-panel-content button.btn-share").click(function(e){e.preventDefault(),_gaq.push(["_trackEvent","scenario","share"]),mixpanel.track("Share Snippet",{sharedBy:"Scenario Page"}),openShareModal($(this).attr("id"))}),ZeroClipboard.config({moviePath:"/ZeroClipboard.swf",hoverClass:"btn-copy-hover",activeClass:"btn-copy-active"}),new ZeroClipboard($(".btn-copy")).on("complete",function(clientText,args){_gaq.push(["_trackEvent","scenario","copy"]);var btnCopy=$(".btn-copy");btnCopy.blur(),$("#global-zeroclipboard-html-bridge").tooltip("hide"),btnCopy.tooltip("show"),setTimeout(function(){btnCopy.tooltip("hide")},2e3)}),$("#global-zeroclipboard-html-bridge").tooltip({title:"Copy code to clipboard",placement:"bottom"}),$(".btn-copy").tooltip({title:"Copied!",placement:"bottom",trigger:"manual"})}function openShareModal(sceId){sceId=sceId||$(".btn-share").attr("id");var title=document.title.replace(/ \(\w+\) \| Codota/,"");$("#shareModalContainer").load("/shareScenario/"+sceId+"?tag="+getParameterByName("tag")+"&title="+encodeURIComponent(title),function(){$("#shareModal").modal("show")})}function computeWeightedRank(e){var weights={},scores={};$(e).parents(".debugInfo").find(".new-weight").each(function(n,newWeight){weights[$(newWeight).attr("name")]=$(newWeight).val()||0,scores[$(newWeight).attr("name")]=Number($(newWeight).parents(".debugline").find(".score").text())||0});var totalScore=0;for(var f in scores)totalScore+=scores[f]*weights[f];return Math.round(1e3*totalScore)/1e3}function moveSourceToInitialPosition(){$(".hl-start").each(function(i,sourceLine){var p=$(sourceLine).parents(".prettyprint");if(0==p.scrollTop()){var currentOffset=$(sourceLine).position().top-p.position().top,delta=Math.max(currentOffset-110,0);p.animate({scrollTop:p.scrollTop()+delta},0)}})}function addSvgHoverInteraction(){$("svg").find(".node").each(function(n,node){var nodeId=$(node).attr("data-nodeId"),sourceLine=$(node).parents(".item").find('.source-hl[data-node="'+nodeId+'"]'),p=$(sourceLine).parents(".prettyprint");$(sourceLine).attr("href");$(node).find("path").attr("fill","white"),$(node).hover(function(e){if(sourceLine.length>0){var currentOffset=$(sourceLine).position().top-p.position().top,delta=currentOffset-150;p.animate({scrollTop:p.scrollTop()+delta},500,function(){})}$(".source-hl").removeClass("source-hl-selected"),sourceLine.addClass("source-hl-selected"),$("svg").find(".node").find("path").attr("fill","white"),$(node).find("path").attr("fill","LightSalmon")}),$(node).click(function(){$(sourceLine).trigger("click")})});var setTimeoutIntent,svgMaxHeight=$("pre.prettyprint").height(),delay=500;if(0==$(".further-reading-links").length)$(".svg-container").css("height",svgMaxHeight);else{var svgMinHeight=$(".svg-container").height();$(".svg-container").hover(function(){setTimeoutIntent=setTimeout(function(){var svgContainer=$(".svg-container");svgContainer.css("z-index",1),svgContainer.animate({height:svgMaxHeight},"fast"),$(".further-reading-container").hide(),_gaq.push(["_trackEvent","scenario","automaton-hover"])},delay)},function(){clearTimeout(setTimeoutIntent),$(this).closest(".img").css("z-index",0),$(this).animate({height:svgMinHeight},"fast",function(){$(".further-reading-container").show()})})}}function applyVote(vote,change){var score=$(".voting-score"),scenarioId=$(vote).attr("id");$.ajax({url:"/api/scenarios/"+scenarioId+"/vote/"+change+"?tag="+getParameterByName("tag"),type:"POST",success:function(response){score.text(Number(score.text())+change),$(".voteDown, .voteUp").css("visibility","hidden").tooltip("hide"),score.tooltip("show"),setTimeout(function(){score.tooltip("hide")},2e3)},error:function(xhr,error){401==xhr.status&&alert('Please log in or sign up to vote. Feel free to give us feedback using the "Feedback & Support" link.'),console.log("Voting failed: "+xhr.status)}})}function copyToClipboard(text){window.prompt("Copy to clipboard: Ctrl+C, Enter",text)}function formatLivecode(){$(".prettyprint").scroll(hideOtherPopovers).click(hideOtherPopovers),$(".var-hl").click(function(e){var varId='[data-varId="'+$(this).attr("data-varId")+'"]';$(this).parents("pre:first").find(".var-hl"+varId).toggleClass("var-hl-selected"),$(this).parents("pre:first").find(".var-hl-selected").not(varId).removeClass("var-hl-selected")}),$(".source-hl").click(function(e){e.stopPropagation(),hideOtherPopovers(this);var classId=$(this).attr("data-classId"),methodIndex=$(this).attr("data-methodIndex");if(classId){var obj=this,findDocApi="/api/apidocs/"+classId;methodIndex&&(findDocApi+="/"+methodIndex),$.getJSON(findDocApi,function(doc){$(obj).popover("destroy"),$(obj).removeAttr("data-classId");var searchLinkHtml='<a class="btn btn-primary btn-small" href="'+$(obj).attr("data-searchTerm")+'">Find examples for '+$(obj).text()+"</a>",docLinkHtml="";$(obj).attr("data-docLink")&&(docLinkHtml=" <a href='"+$(obj).attr("data-docLink")+"' target='_blank'>API Doc</a>"),""==doc.text&&(doc.text="No documentation available.");var popoverHtml=doc.text+docLinkHtml+"<hr>"+searchLinkHtml;$(obj).popover({trigger:"manual",content:popoverHtml}),$(obj).popover("toggle").toggleClass("source-hl-with-bubble")})}else $(this).popover("toggle").toggleClass("source-hl-with-bubble"),$(".popover").find("a").click(function(e){e.stopPropagation()})}),$(".source-hl").popover({trigger:"manual"}),$('[rel="tooltip"]').tooltip({trigger:"hover"})}function hideOtherPopovers(t){$(".source-hl").not(t).popover("hide").removeClass("api-hl-selected")}function trackEvents(){$(".var-hl").on("shown",function(e){_gaq.push(["_trackEvent","var","tooltip",$(this).text()])}),$(".var-hl").click(function(e){_gaq.push(["_trackEvent","var","clicked",$(this).text()])}),$(".api-hl").click(function(e){var clickedApi=$(this).attr("data-title");_gaq.push(["_trackEvent","api","clicked",clickedApi])}),$(".type-hl").click(function(e){var clickedApi=$(this).attr("data-title");_gaq.push(["_trackEvent","class","clicked",clickedApi])}),trackActions();var sceId=$(".item").attr("id");sceId&&setTimeout(function(){_gaq.push(["_trackEvent","scenario","no-bounce",sceId])},3e4)}function trackActions(){$("[data-action]").click(function(e){e.stopPropagation();var action=$(this).attr("data-action"),label=$(this).attr("data-label"),scenarioId=$(this).attr("id"),saveSnippetBtn=$(this).hasClass("save-snippet");saveSnippetBtn&&(_gaq.push(["_trackEvent","scenario","save-snippet",label]),e.preventDefault()),$.ajax({url:"/api/scenarios/"+scenarioId+"/"+action+"?tag="+getParameterByName("tag"),type:"PUT",success:function(response){saveSnippetBtn&&(window.location.href=updateQueryStringParameter(window.location.search,"cbSnippetSaved","1"))},error:function(xhr,error){401==xhr.status&&(window.location.href="/login?afterAuth="+encodeURIComponent(window.location.href)),console.log("action failed: "+xhr.status)}})})}function setCookie(cname,cvalue){var d=new Date;d.setTime(d.getTime()+5184e7);var expires="expires="+d.toGMTString();document.cookie=cname+"="+cvalue+"; "+expires+"; path=/"}function loadLoginModal(afterAuth){var loginModalUrl="/loginModal";afterAuth&&(loginModalUrl+="?afterAuth="+encodeURIComponent(afterAuth)),$("#loginModalContainer").load(loginModalUrl,function(){$("#loginModal").modal("show"),_gaq.push(["_trackEvent","loginModal","show"]),mixpanel.track("Login Wall"),trackLoginAttempts()})}function trackLoginAttempts(){$(".login-btn").click(function(e){var provider=$(this).text();_gaq.push(["_trackEvent","login",provider]),mixpanel.track("Login Attempt",{provider:provider})})}function loadSocialWidgets(){$(".g-plusone-placeholder").addClass("g-plusone").removeClass("g-plusone-placeholder"),function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="https://platform.twitter.com/widgets.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","twitter-wjs"),function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="https://connect.facebook.net/en_US/all.js#xfbml=1",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk"),function(){var po=document.createElement("script");po.type="text/javascript",po.async=!0,po.src="https://apis.google.com/js/plusone.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(po,s)}(),$.getScript("https://platform.linkedin.com/in.js"),$("#social-placeholder").hide()}var map={},navBarCompletions={},newRender=function(items){var that=this;return items=$(items).map(function(i,item){return i=$(that.options.item).attr("data-value",item),i.find("a").html(that.highlighter(item)),i[0]}),that.options.shouldSelectFirstItem&&items.first().addClass("active"),this.$menu.html(items),this};$.fn.typeahead.Constructor.prototype.render=newRender,$.fn.typeahead.Constructor.prototype.select=function(){var val=this.$menu.find(".active").attr("data-value");return val?this.$element.val(this.updater(val)).change():$("button.typeahead").trigger("click"),this.hide()},$.fn.typeahead.Constructor.prototype.mouseleave=function(e){this.mousedover=!1,this.$menu.find(".active").removeClass("active")},$(document).ready(function(){$(".nonaccount-typeahead").attr("autocomplete","off"),$(".nonaccount-typeahead").typeahead({source:typeaheadSource,items:20,sorter:function(items){return items},updater:function(item){if(item in map){var taskId=map[item];window.location="/android/tasks/"+taskId+"?source=typeahead"}else submitSearchQuery(item,$(".search-filter-element .dropdown-toggle").text());return item}}),$(".account-typeahead").attr("autocomplete","off"),$(".account-typeahead").typeahead({source:function(query,callback){var pack=window.location.hash.split("/")[1];$.ajax({url:"/api/search/navbarTypeahead/"+encodeURIComponent(query)+"?codePack="+pack,dataType:"json",error:function(data){return navBarCompletions={},callback([])},success:function(data){return navBarCompletions=data,callback(Object.keys(data))}})},items:30,sorter:function(items){return items},updater:function(item){if(!(item in navBarCompletions))return item;navBarCompletions[item];return navigateToRichSearch(item),item}}).on("keyup",this,function(event){if(13==event.keyCode){navigateToRichSearch($(".account-typeahead").val())}}),$(".search-filter-element .dropdown-menu").on("click","li a",function(){submitSearchQuery($("input.typeahead").val(),$(this).text())}),$("div#rich-search").keyup(function(event){13==event.keyCode&&navigateToRichSearch($(this).find("input").val())}),$("div#rich-search button").on("click",function(event){navigateToRichSearch($(this).parent().find("input").val())}),$("form[id^=search]").on("submit",function(){0==$("form[id^=search] input[name='target']").length&&$(this).append($("<input>").attr("type","hidden").attr("name","target").val("all"))})}),$(document).ready(function(){handlePrettify(),trackEvents(),showTagsOnSnippetHover(),addSaveSnippetPopover(),showCodeBoxNavbarPopover(),setDeleteSnippetButton(),shareScenarioIfNeeded()});var ranShareScripts=!1;!function($){$.isMobile=function(){return"none"===$("#mobileDetector").css("display")}}(jQuery),$(document).ready(function(){function notImplementedModal(desc){$("#notImplementedModalContainer").load("/notImplemented?featureName="+encodeURIComponent(desc),function(){$("#notImplementedModal").modal("show")})}$(".svg-container").scrollLeft($(".svg-container").children("svg").width()/4),$(".not-implemented").click(function(e){var featureName=$(this).attr("data-featureName")||$(this).text();_gaq.push(["_trackEvent","not_implemented",featureName]),notImplementedModal(featureName)}),$(".snippet-details").click(function(e){_gaq.push(["_trackEvent","short-snippets","navigate-to-details"])});$("[data-eventCategory]").click(function(){var eventCategory=$(this).attr("data-eventCategory"),eventAction=$(this).attr("data-eventAction"),eventLabel=$(this).attr("data-eventLabel");_gaq.push(["_trackEvent",eventCategory,eventAction,eventLabel])}),$('[rel="tooltip"]').tooltip({}),$('[data-rel="tooltip"]').tooltip({}),trackLoginAttempts(),loadSocialWidgets()});
